$(function(){var ai,m,r,T=false,A=true,ac,ae,U,o,D,Z,s,E,R,c,aa,Q=[],W=[],af=[],q=[],Y=[],ad=[],am,al=3,ah,u,I,h=[false,false,false],C,l,H=-1,O,d,J=false,N=0,x=13,f=65,k=40,w=1,t,a=[],M,g=2,P,an=0,B,V=0;if($("canvas").length>0){m=$("#canvas")[0];r=new createjs.Stage(m);b();S();X();createjs.Ticker.addEventListener("tick",r);P=setInterval(function(){v()},1000/g)}function S(){ae={animations:{edgeON:{frames:[0]},edgeOFF:{frames:[1]},edge:{frames:[2]},spinNums:{frames:[3,4,5,6,7]},btnPLAY:{frames:[8]},btnSTOP:{frames:[9]},locked:{frames:[10]},unlocked:{frames:[11]},reset:{frames:[12]}},framerate:20,images:["images/spriteSheet.png"],frames:[[356,2,28,61,0,0,0],[412,2,28,61,0,0,0],[384,2,28,61,0,0,0],[518,2,26,59,0,-1,-1],[492,2,26,59,0,-1,-1],[466,2,26,59,0,-1,-1],[544,2,26,59,0,-1,-1],[440,2,26,59,0,-1,-1],[606,2,36,36,0,0,0],[570,2,36,36,0,0,0],[238,2,118,61,0,0,0],[120,2,118,61,0,0,0],[2,2,118,61,0,0,0]]};ac=new createjs.SpriteSheet(ae);y()}function y(){for(ai=0;ai<3;ai+=1){U=new createjs.Sprite(ac,"spinNums");U.x=92+(82*ai);U.y=65;U.stop();Q.push(U);o=new createjs.Sprite(ac,"edge");o.x=U.x;o.y=U.y;W.push(o);D=new createjs.Sprite(ac,"edgeOFF");D.x=U.x;D.y=U.y;q.push(D);Z=new createjs.Sprite(ac,"edgeON");Z.x=U.x;Z.y=U.y;af.push(Z);s=new createjs.Sprite(ac,"btnPLAY");s.name="btn"+ai;s.x=U.x-4;s.y=U.y+78;ad.push(s);E=new createjs.Sprite(ac,"btnSTOP");E.name="btn"+ai;E.x=s.x;E.y=s.y;Y.push(E);s.addEventListener("click",e);E.addEventListener("click",e);r.addChild(U);r.addChild(o);r.addChild(s)}R=new createjs.Sprite(ac,"locked");R.x=U.x+100;R.y=U.y;c=new createjs.Sprite(ac,"unlocked");c.x=R.x;c.y=R.y;aa=new createjs.Sprite(ac,"reset");aa.x=R.x;aa.y=R.y;aa.addEventListener("click",ab);r.addChild(R);M=new createjs.Text("");M.text="Sound loop sync test:\nSync the (five second) loops to unlock the puzzle.";M.font="16px Arial";M.color="#999";M.x=45;M.y=4;r.addChild(M)}function v(){an++;p()}function e(i){if(A){A=false;am.play("nub")}if(!T){ak(parseInt(i.target.name.substr(3,1),10))}}function ak(i){if(H===-1){H=i}if(h[i]===false){ag(true,i);r.removeChild(ad[i]);r.addChild(Y[i]);r.addChild(K()?af[i]:q[i]);Q[i].play()}else{r.removeChild(Y[i]);r.addChild(ad[i]);ag(false,i)}h[i]=!h[i]}function X(){am=new Howl({urls:["sounds/audioSprite.mp3","audioSprite/count.ogg"],loop:false,sprite:{v0:[400,2800],v1:[5400,2800],v2:[10400,2800],nub:[0,1]}});ah=["","",""];u=[3*g,3*g,3*g];I=[true,true,true]}function ag(i,ao){if(i){ah[ao]=aj(ao,true)}else{ah[ao]=aj(ao,false)}O=true;for(ai=0;ai<al;ai+=1){if(!ah[ai].inPlay||ah[ai].pollCount!=0){O=false;break}}}function aj(ao,i){return{inPlay:i,sprite:"v"+ao,span:u[ao],pollCount:ah[ao].inPlay?ah[ao].pollCount:0,loop:I[ao]}}function p(){n();j();V=0;B=setInterval(function(){G()},5)}function n(){d=true;for(ai=0;ai<al;ai+=1){if(ah[ai].inPlay){d=false;break}}if(d){H=-1}}function j(){C=0;l=-1;for(ai=0;ai<al;ai+=1){if(ah[ai].inPlay){C+=1;l=ai}}if(C===1){H=l;r.removeChild(q[H]);r.addChild(af[H])}}function K(){return ah[H].pollCount==0?true:false}function G(){if(ah[V]==undefined){return}if(!ah[V].inPlay){ah[V].pollCount+=1;if(ah[V].pollCount>=ah[V].span){z(V)}}else{if(ah[V].pollCount===0){am.play(ah[V].sprite)}ah[V].pollCount+=1;if(ah[V].pollCount===ah[V].span){if(!ah[V].loop){ah[V]=aj(V,false)}else{ah[V].pollCount=0}}}V+=1;if(V>=ah.length){clearInterval(B);if(J){N+=1;if(N>=ah[0].span){J=false;F()}}if(O){for(ai=0;ai<al;ai+=1){ah[ai]=aj(ai,false)}r.removeChild(R);r.addChild(c);L();J=true;N=0;T=true;O=false}}}function z(i){Q[i].stop();r.removeChild(af[i]);r.removeChild(q[i])}function F(){for(ai=0;ai<al;ai+=1){z(ai)}r.removeChild(c);r.addChild(aa)}function ab(i){for(ai=0;ai<al;ai+=1){r.removeChild(Y[ai]);r.addChild(ad[ai])}h=[false,false,false];r.removeChild(aa);r.addChild(R);T=false}function b(){for(ai=0;ai<f;ai+=1){t=new createjs.Shape();t.graphics.beginFill("#f3f3f3").drawRect(-k*0.5,-k*0.5,k,k);t.x=k*0.5+2+(k+w)*(ai%x);t.y=k*0.5+2+(k+w)*(Math.floor(ai/x));a.push(t);r.addChild(t)}r.update()}function L(){for(ai=0;ai<f;ai+=1){TweenMax.to(a[ai],0.5,{scaleX:0,delay:ai*0.01});TweenMax.to(a[ai],0.5,{scaleX:1,delay:ai*0.01+0.5})}}});